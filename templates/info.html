<!-- templates/index.html -->
<div class="title">MiniWeb</div>
<div class="subtitle">Un web server minimalista per OpenBSD</div>

<div id="table-of-contents">
<h2>Indice dei Contenuti</h2>
<ul>
  <li><a href="#intro">Introduzione</a></li>
  <li><a href="#features">Caratteristiche</a></li>
  <li><a href="#openbsd-tech">Tecnologie OpenBSD</a></li>
  <li><a href="#security">Sicurezza</a></li>
  <li><a href="#performance">Prestazioni</a></li>
  <li><a href="#usage">Utilizzo</a></li>
</ul>
</div>

<div class="outline-2">
<h2 id="intro">Introduzione</h2>
<p><strong>MiniWeb</strong> è un web server HTTP minimalista sviluppato specificamente per OpenBSD, 
progettato con i principi di semplicità, sicurezza e prestazioni tipici dell'ecosistema BSD.</p>

<p>Nato come progetto dimostrativo, MiniWeb implementa tutte le funzionalità essenziali di un web server 
moderno mantenendo una codebase estremamente compatta e comprensibile.</p>
<p>Il server è ottimizzato per ambienti OpenBSD, sfruttando le tecnologie native come <code>kqueue</code> per le notifiche di eventi, <code>pledge</code> per la restrizione delle system call, e <code>unveil</code> per il controllo degli accessi al filesystem.</p>
</div>

<div class="outline-2" id="features">
<h2 id="features">Caratteristiche Principali</h2>

<div class="outline-3">
<h3>Architettura Event-Driven</h3>
<pre><code class="src">int kq = kqueue();
struct kevent events[MAX_EVENTS];
kevent(kq, NULL, 0, events, MAX_EVENTS, NULL);</code></pre>
<p>Utilizza <strong>kqueue</strong> per gestire migliaia di connessioni simultanee con basso consumo di risorse.</p>
</div>

<div class="outline-3">
<h3>Sistema di Template</h3>
<pre><code>&lt;!-- base.html --&gt;
&lt;head&gt;
  &lt;title&gt;{{title}}&lt;/title&gt;
  {{extra_head}}
&lt;/head&gt;</code></pre>
<p>Template engine leggero che supporta variabili dinamiche e inclusione di file opzionali.</p>
</div>

<div class="outline-3">
<h3>Routing Dinamico</h3>
<pre><code>struct route routes[] = {
  { "GET", "/", index_view },
  { "GET", "/about", about_view }
};</code></pre>
<p>Sistema di routing semplice ma potente per mappare URL a funzioni handler.</p>
</div>
</div>


<div class="outline-3">
<h3>Supporto Proxy/Relayd</h3>
<pre><code>struct http_request {
  char host[256];
  char x_forwarded_for[256];
  // ...
};</code></pre>
<p>Parsing degli headers HTTP completo per compatibilità con relayd e reverse proxy.</p>
</div>

<div class="outline-3">
<h3>Gestione Connessioni Avanzata</h3>
<pre><code>#define MAX_ACTIVE_CONNECTIONS 2000
static volatile sig_atomic_t active_connections = 0;</code></pre>
<p>Tracking e limitazione delle connessioni attive con backoff automatico.</p>
</div>


<div class="outline-2" id="openbsd-tech">
<h2 id="openbsd-tech">Tecnologie OpenBSD Utilizzate</h2>

<table>
<thead>
<tr>
<th>Tecnologia</th>
<th>Scopo</th>
<th>Vantaggio</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>kqueue</strong></td>
<td>Event Notification</td>
<td>Performance superiori a select/poll</td>
</tr>
<tr>
<td><strong>pledge(2)</strong></td>
<td>Sistema di promesse</td>
<td>Restrizione capability in runtime</td>
</tr>
<tr>
<td><strong>unveil(2)</strong></td>
<td>Controllo filesystem</td>
<td>Accesso minimo ai file necessari</td>
</tr>
<tr>
<td><strong>strlcpy/strlcat</strong></td>
<td>String manipulation</td>
<td>Sicurezza buffer overflow</td>
</tr>
<tr>
<td><strong>arc4random(3)</strong></td>
<td>Generazione casuale</td>
<td>Crittograficamente sicuro</td>
</tr>
<tr>
<td><strong>fstat vs stat</strong></td>
<td>Prevenzione TOCTOU</td>
<td>Evita race conditions sui file</td>
</tr>
</tbody>
</table>

<blockquote>
<p>OpenBSD è famosa per il suo focus sulla sicurezza, correttezza del codice e documentazione precisa.</p>
</blockquote>
</div>

<div class="outline-2" id="security">
<h2 id="security">Modello di Sicurezza</h2>

<p>MiniWeb implementa un modello di sicurezza <strong>defense-in-depth</strong>:</p>

<ul>
<li><span class="done">✓</span> <strong>pledge()</strong> limita le syscall disponibili</li>
<li><span class="done">✓</span> <strong>unveil()</strong> restringe l'accesso al filesystem</li>
<li><span class="done">✓</span> <strong>Memory-safe</strong> allocazione dinamica con free automatico</li>
<li><span class="done">✓</span> <strong>Input validation</strong> contro directory traversal e path traversal</li>
<li><span class="done">✓</span> <strong>TOCTOU protection</strong> con fstat() dopo open()</li>
<li><span class="todo">○</span> <strong>Rate limiting</strong> (in sviluppo)</li>
<li><span class="todo">○</span> <strong>Connection timeouts</strong> (in sviluppo)</li>
</ul>

<pre><code>// Esempio di lockdown con pledge/unveil
pledge("stdio rpath inet", NULL);
unveil("templates", "r");
unveil("static", "r");
unveil(NULL, NULL); // lock</code></pre>
</div>

<div class="outline-2" id="performance">
<h2 id="performance">Prestazioni e Design</h2>

<div class="figure">
<p>Architettura di MiniWeb</p>
</div>

<ul>
<li><strong>Single-threaded</strong>: Event loop asincrono con kqueue</li>
<li><strong>Zero-copy</strong>: Invio diretto dei file statici</li>
<li><strong>Connection: close</strong>: Gestione semplificata delle connessioni</li>
<li><strong>Memory-mapped</strong>: File statici serviti efficientemente</li>
</ul>

<p>Benchmark preliminari mostrano capacità di gestire <strong>~5000 richieste/secondo</strong> su hardware modesto.</p>
</div>

<div class="outline-2" id="usage">
<h2 id="usage">Utilizzo Pratico</h2>

<h3>Compilazione</h3>
<pre><code>$ make clean
$ make
$ ./build/miniweb --help</code></pre>

<h3>Avvio del Server</h3>
<pre><code># Modalità sviluppo (verbose)
$ ./miniweb -vv -p 8080

# Modalità produzione (daemon)
$ ./miniweb -d -b 0.0.0.0 -p 9001

# Con limite connessioni personalizzato (nel codice)
$ ./miniweb -p 8080  # MAX_ACTIVE_CONNECTIONS = 2000</code></pre>

<h3>Struttura del Progetto</h3>
<pre><code>miniweb/
├── src/           # Codice sorgente C (http_server.c, router.c, ...)
├── include/       # Header files (http_server.h, response.h, ...)
├── templates/     # File template HTML (base.html, index.html, ...)
├── static/        # File statici (CSS, JS, immagini, favicon)
├── benchmark/     # Script e risultati performance
└── build/         # File compilati (.o, binario)</code></pre>
</div>

<div id="postamble">
<p>MiniWeb è software open source rilasciato sotto licenza BSD.<br>
Progetto educativo per comprendere i principi dei web server e le tecnologie OpenBSD.</p>
<p class="timestamp">Ultimo aggiornamento: Febbraio 2026 | Versione: 1.1</p>
</div>
